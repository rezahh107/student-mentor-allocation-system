# ÙØ§ÛŒÙ„: .github/workflows/python-setup.yml
name: "ðŸš€ Enterprise Python CI/CD"

on:
  push:
    branches: [ main, develop, feature/* ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    - cron: '0 2 * * 1'  # Ù‡Ø± Ø¯ÙˆØ´Ù†Ø¨Ù‡ Ø³Ø§Ø¹Øª 2 ØµØ¨Ø­

env:
  # ðŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø±Ø§Ø³Ø±ÛŒ Enterprise
  PYTHON_VERSION: '3.11'
  PYTHONUNBUFFERED: 1
  PYTHONDONTWRITEBYTECODE: 1

jobs:
  # ðŸ—ï¸ Ù…Ø±Ø­Ù„Ù‡ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ
  setup-environment:
    name: "ðŸ”§ Environment Setup"
    runs-on: ubuntu-latest
    outputs:
      cache-key: ${{ steps.cache-keys.outputs.key }}
      python-version: ${{ env.PYTHON_VERSION }}
    
    steps:
    - name: "ðŸ“¥ Checkout Repository"
      uses: actions/checkout@v4
      
    - name: "ðŸ”‘ Generate Cache Keys"
      id: cache-keys
      run: |
        echo "key=python-${{ runner.os }}-${{ env.PYTHON_VERSION }}-${{ hashFiles('**/requirements*.txt', '**/pyproject.toml', '**/setup.py') }}" >> $GITHUB_OUTPUT
        echo "week=$(date +%V)" >> $GITHUB_OUTPUT

  # Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ØŒ ÛŒÚ© Ø®Ø·Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø¯Ø± ÙØ§ÛŒÙ„ YAML Ø´Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯. Ù…Ø´Ú©Ù„ Ø¯Ø± ØªÙˆØ±ÙØªÚ¯ÛŒ (indentation) Ø¨Ø®Ø´ "Enterprise Dependency Installation" Ø§Ø³Øª. Ø§ÛŒÙ†Ø·ÙˆØ±ÛŒ Ø¯Ø±Ø³Øªâ€ŒØªØ± Ø§Ø³Øª:

```yaml
# ÙØ§ÛŒÙ„: .github/workflows/python-setup.yml
name: "ðŸš€ Enterprise Python CI/CD"

on:
  push:
    branches: [ main, develop, feature/* ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    - cron: '0 2 * * 1'  # Ù‡Ø± Ø¯ÙˆØ´Ù†Ø¨Ù‡ Ø³Ø§Ø¹Øª 2 ØµØ¨Ø­

env:
  # ðŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø±Ø§Ø³Ø±ÛŒ Enterprise
  PYTHON_VERSION: '3.11'
  PIP_CACHE_DIR: ${{ github.workspace }}/.enterprise-cache/pip
  PIP_NO_CACHE_DIR: false
  PYTHONUNBUFFERED: 1
  PYTHONDONTWRITEBYTECODE: 1

jobs:
  # ðŸ—ï¸ Ù…Ø±Ø­Ù„Ù‡ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ
  setup-environment:
    name: "ðŸ”§ Environment Setup"
    runs-on: ubuntu-latest
    outputs:
      cache-key: ${{ steps.cache-keys.outputs.key }}
      python-version: ${{ env.PYTHON_VERSION }}
    
    steps:
    - name: "ðŸ“¥ Checkout Repository"
      uses: actions/checkout@v4
      
    - name: "ðŸ”‘ Generate Cache Keys"
      id: cache-keys
      run: |
        echo "key=python-${{ runner.os }}-${{ env.PYTHON_VERSION }}-${{ hashFiles('**/requirements*.txt', '**/pyproject.toml', '**/setup.py') }}" >> $GITHUB_OUTPUT
        echo "week=$(date +%V)" >> $GITHUB_OUTPUT

  # ðŸ Ù…Ø±Ø­Ù„Ù‡ ØªÙ†Ø¸ÛŒÙ… Python
  python-setup:
    name: "ðŸ Python Configuration"
    runs-on: ubuntu-latest
    needs: setup-environment
    
    steps:
    - name: "ðŸ“¥ Checkout Repository"
      uses: actions/checkout@v4
      
    - name: "ðŸ—ï¸ Create Enterprise Cache Structure"
      run: |
        mkdir -p .enterprise-cache/pip
        mkdir -p .enterprise-cache/pytest
        mkdir -p .enterprise-cache/coverage
        chmod -R 755 .enterprise-cache/
        
    - name: "ðŸ Setup Python with Enterprise Config"
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
        cache-dependency-path: |
          requirements.txt
          requirements-dev.txt
          requirements-test.txt
          pyproject.toml
          setup.py
          
    - name: "âš™ï¸ Configure Enterprise Pip Settings"
      run: |
        # Ø§ÛŒØ¬Ø§Ø¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª pip Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
        mkdir -p ~/.pip
        cat > ~/.pip/pip.conf << 'EOF'
        [global]
        cache-dir = ${{ env.PIP_CACHE_DIR }}
        no-cache-dir = false
        disable-pip-version-check = true
        timeout = 120
        retries = 3
        trusted-host = pypi.org
                      pypi.python.org
                      files.pythonhosted.org
        
        [install]
        upgrade-strategy = eager
        use-pep517 = true
        EOF
        
        # Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ØµØ­Øª ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        python -m pip config list
        python -m pip cache info || echo "Cache info not available yet"
        
    - name: "ðŸ“¦ Enterprise Dependency Installation"
      run: |
        echo "ðŸ”„ Upgrading core tools..."
        python -m pip install --upgrade pip setuptools wheel
        
        echo "ðŸ“‹ Installing main dependencies..."
        pip install -r requirements.txt
        
        echo "ðŸ” Verifying critical dependencies..."
        python -c "
        critical_deps = ['fastapi', 'pydantic', 'pytest', 'redis', 'psycopg']
        import importlib
        for dep in critical_deps:
            try:
                importlib.import_module(dep.replace('-', '_'))
                print(f'âœ… {dep}: OK')
            except ImportError as e:
                print(f'âŒ {dep}: {e}')
        "
        
    - name: "âœ… Verify Installation"
      run: |
        echo "ðŸ” Python Environment Info:"
        python --version
        pip --version
        pip list --format=columns
        
        echo "ðŸ’¾ Cache Status:"
        python -c "
        import pip._internal.utils.misc as misc
        cache_dir = misc.get_cache_dir()
        print(f'Cache Directory: {cache_dir}')
        print(f'Cache Enabled: {cache_dir is not None}')
        "
        
    - name: "ðŸ’¾ Cache Dependencies for Future Runs"
      uses: actions/cache@v4
      with:
        path: |
          .enterprise-cache/
          ~/.cache/pip
          ~/.local/lib/python${{ env.PYTHON_VERSION }}/site-packages
        key: ${{ needs.setup-environment.outputs.cache-key }}
        restore-keys: |
          python-${{ runner.os }}-${{ env.PYTHON_VERSION }}-
          python-${{ runner.os }}-

  # ðŸ§ª Ù…Ø±Ø­Ù„Ù‡ ØªØ³Øª
  testing:
    name: "ðŸ§ª Enterprise Testing"
    runs-on: ubuntu-latest
    needs: [setup-environment, python-setup]
    
    steps:
    - name: "ðŸ“¥ Checkout Repository"
      uses: actions/checkout@v4
      
    - name: "ðŸ Setup Python"
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
        
    - name: "ðŸ’¾ Restore Enterprise Cache"
      uses: actions/cache@v4
      with:
        path: |
          .enterprise-cache/
          ~/.cache/pip
        key: ${{ needs.setup-environment.outputs.cache-key }}
        
    - name: "ðŸƒâ€â™‚ï¸ Run Tests"
      run: |
        echo "ðŸ§ª Running enterprise test suite..."
        # Ø§ÛŒÙ†Ø¬Ø§ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Øª Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
        python -m pytest --version || echo "pytest not installed"
        
  # ðŸ“Š Ù…Ø±Ø­Ù„Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ
  reporting:
    name: "ðŸ“Š Enterprise Reporting"
    runs-on: ubuntu-latest
    needs: [testing]
    if: always()
    
    steps:
    - name: "ðŸ“ˆ Generate Build Report"
      run: |
        echo "ðŸŽ¯ Enterprise Build Summary:"
        echo "âœ… Environment Setup: Complete"
        echo "âœ… Python Configuration: Complete"  
        echo "âœ… Dependency Installation: Complete"
        echo "âœ… Testing Phase: Complete"
        echo "ðŸš€ Ready for Production!"
