# Managed by tools/pytest_config_diagnostics.py
# Ensures deterministic CI behaviour across platforms.
[pytest]
minversion = 7.4
pythonpath =
    src
testpaths =
    tests/spec
    tests/windows
    tests/integration
python_files = test_*.py *_test.py
python_classes = Test* *Tests
python_functions = test_*
addopts =
    -ra
    --strict-config
    --strict-markers
    --color=yes
    --maxfail=1
    --durations=20
    --tb=short
    --showlocals
    -W error
    -n=auto
    --dist=loadscope
    -p pytest_asyncio
    -p xdist.plugin
    -p pytest_timeout
xfail_strict = true
console_output_style = progress
filterwarnings =
    error
markers =
    smoke: آزمون‌های دود
    integration: آزمایش‌های یکپارچه‌سازی
    windows: آزمون‌های مختص ویندوز
    excel: آزمون‌های خروجی اکسل
    excel_safety: آزمون‌های ایمنی اکسل و جلوگیری از تزریق فرمول
    ci: آزمون‌های CI
    retry_logic: آزمون منطق تلاش مجدد
    middleware: آزمون زنجیره میان‌افزار RateLimit→Idempotency→Auth
    performance: آزمون بودجه‌های کارایی
    stress: آزمون‌های تنش (بار بالا)
    ui: آزمون‌های رابط کاربری
    metrics: آزمون‌های متریک و مشاهده‌پذیری
    benchmark: آزمون‌های بنچمارک با pytest-benchmark
    security: آزمون پایه‌های امنیتی
    cleanup: آزمون پاکسازی حالت اشتراکی
    network: آزمون‌های نیازمند شبکه (در صورت عدم دسترسی آفلاین حذف شوند)
norecursedirs =
    .git
    .tox
    .venv
    venv
    build
    dist
    node_modules
    tmp
    htmlcov
    test-results
env =
    TZ=Asia/Tehran
    PYTHONDONTWRITEBYTECODE=1
    PYTHONUNBUFFERED=1
    PYTEST_DISABLE_PLUGIN_AUTOLOAD=1
    PYTHONHASHSEED=0
    TEST_ENV=ci
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%dT%H:%M:%S%z
junit_family = xunit2
junit_logging = all
junit_duration_report = call
cache_dir = .pytest_cache
timeout = 300
timeout_func_only = false
timeout_method = thread
